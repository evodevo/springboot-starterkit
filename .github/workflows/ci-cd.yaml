name: Create and publish a Docker image
on: push
jobs:
  build:
    name: Build & push docker image
    runs-on: ubuntu-latest
    env:
      IMG_NAME: ${{ github.repository }}
    steps:
      - name: Shallow Clone (depth=1)
        uses: actions/checkout@master
        with:
          fetch-depth: 1
      
      - name: Build docker image
        run: docker build -t $IMG_NAME -f ./Dockerfile .

      - name: Tag image
        run: docker tag $IMG_NAME $IMG_NAME:$(git log -1 --pretty=%h)
      